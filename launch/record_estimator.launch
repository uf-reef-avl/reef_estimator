<launch>

    <arg name="vehicle" default="kiwi"/>
    <arg name="run_estimator" default="true"/>
    <arg name="run_verify" default="false"/>
    <arg name="run_odom_to_velocity" default="false"/>
    <arg name="run_uncc" default="false"/>
    <arg name="run_demo_rgbd" default="true"/>
    <arg name="run_mocap_vel" default="true"/>
    <arg name="play_bag" default="true"/>
    <arg name="run_plot_juggler" default="false"/>
    <arg name="run_image_view" default="false"/>
    <arg name="run_histogram" default="false"/>
    <arg name="record_bag" default="false"/>
    <arg name="bag_name" default="test"/>

    <rosparam command="load" file="$(find reef_estimator)/params/$(arg vehicle)_camera.yaml" />

    <node name="reef_estimator" pkg="reef_estimator" type="reef_estimator" output="screen">
        <rosparam file="$(find reef_estimator)/params/xy_est_params.yaml" />
        <rosparam file="$(find reef_estimator)/params/z_est_params.yaml" />
        <rosparam file="$(find reef_estimator)/params/basic_params.yaml" />
        <rosparam>
            enable_rgbd: true
            enable_sonar: true
            enable_mocap_xy: false
            enable_mocap_z: false
        </rosparam>
        <remap from="mocap_ned" to="pose_stamped"/>
        <remap from="mocap_velocity/body_level_frame" to="velocity/body_level_frame"/>
        <remap from="rgbd_velocity_body_frame" to="rgbd_to_velocity/body_level_frame"/>
    </node>


    <group if="$(arg run_demo_rgbd)">
<!--        <include file="$(find demo_rgbd)/launch/demo_bag.launch">-->
<!--        </include>-->
        <include file="$(find rgbd_to_velocity)/launch/rgbd_to_velocity.launch"/>
<!--        <rosparam command="load" file="$(find demo_rgbd)/params/kiwi_camera.yaml" />-->
        <include file="$(find demo_rgbd)/launch/demo_rgbd.launch"/>

    </group>


    <group if="$(arg run_uncc)">

        <node name="odom_to_velocity" pkg="odom_to_velocity" type="odom_to_velocity_node" output="screen">
            <rosparam command="load" file="$(find odom_to_velocity)/params/basic.yaml" />
        </node>

<!--        <include if="$(arg run_uncc)" file="$(find uncc_rgbd_odom)/launch/odom_only.launch">-->
<!--            <arg name="rgb_topic" default="image_raw"/>-->
<!--            <arg name="depth_topic" default="image_raw"/>-->
<!--        </include>-->

        <include if="$(arg run_uncc)" file="$(find uncc_rgbd_odom)/launch/astra_rgbd.launch">
<!--            <arg name="rgb_topic" default="image_raw"/>-->
<!--            <arg name="depth_topic" default="image_raw"/>-->
        </include>
    </group>


    <node if="$(arg run_mocap_vel)" name="pose_to_vel" pkg="position_to_velocity" type="position_to_velocity_node" output="screen" >
        <rosparam command="load" file="$(find position_to_velocity)/params/basic.yaml" />
    </node>

    <node if="$(arg record_bag)" name="record" pkg="rosbag" type="record" args="-O $(arg bag_name) imu/data sonar status pose_stamped xyz_debug_estimate rgbd_velocity/body_level_frame velocity/body_level_frame  camera/rgb/image_raw camera/rgb/camera_info camera/depth_registered/image_raw camera/rgb/image_mono camera/depth/image "/>


</launch>
