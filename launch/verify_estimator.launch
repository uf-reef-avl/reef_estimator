<launch>

    <arg name="vehicle" default="dodo"/>
    <arg name="run_estimator" default="true"/>
    <arg name="use_rgbd" default="true"/>
    <arg name="run_uncc" default="false"/>
    <arg name="run_mocap_vel" default="false"/>
    <arg name="play_bag" default="true"/>
    <arg name="run_plot_juggler" default="true"/>
    <arg name="run_image_view" default="true"/>

    <rosparam command="load" file="$(find reef_estimator)/params/$(arg vehicle)_camera.yaml" />

    <group if="$(arg play_bag)">
        <arg name="bag_path" default="/home/prashant/Documents/Verify_Estimates/20190325_001_bag_filtered.bag"/>
        <node pkg="rosbag" type="play" name="player" output="screen" args="--clock --pause $(arg bag_path)"/>
    </group>

    <group if="$(arg run_plot_juggler)">
        <arg name="load_measurement_layout" default="true"/>

        <arg unless="$(arg load_measurement_layout)" name="layout_path" default="/home/prashant/Documents/Verify_Estimates/sync_estimates_layout.xml"/>
        <arg if="$(arg load_measurement_layout)" name="layout_path" default="/home/prashant/Documents/Verify_Estimates/sync_estimates_measurements_layout.xml"/>
        <node name="plotjuggler_with_layout" pkg="plotjuggler" type="PlotJuggler" args="--layout $(arg layout_path)"/>
    </group>

    <node if="$(arg run_estimator)" name="reef_estimator" pkg="reef_estimator" type="reef_estimator" output="screen">
        <rosparam file="$(find reef_estimator)/params/xy_est_params.yaml" />
        <rosparam file="$(find reef_estimator)/params/z_est_params.yaml" />
        <rosparam>
            enable_rgbd: true
            enable_sonar: true
            enable_mocap_xy: false
            enable_mocap_z: false
            debug_mode: true
            enable_partial_update: true
            enable_mocap_switch: false
            mahalanobis_d_sonar: 20
            mahalanobis_d_rgbd_velocity: 40
            mahalanobis_d_mocap_z: 20
            mahalanobis_d_mocap_velocity: 50
        </rosparam>
        <remap from="mocap_ned" to="pose_stamped"/>
        <remap from="mocap_velocity/body_level_frame" to="velocity/body_level_frame"/>
        <remap from="rgbd_velocity_body_frame" to="rgbd_velocity/body_level_frame"/>
    </node>

    <group if="$(arg use_rgbd)">

        <node name="odom_to_velocity" pkg="odom_to_velocity" type="odom_to_velocity_node" output="screen">
            <rosparam command="load" file="$(find odom_to_velocity)/params/basic.yaml" />
        </node>

        <include if="$(arg run_uncc)" file="$(find uncc_rgbd_odom)/launch/odom_only.launch"/>

    </group>


    <node if="$(arg run_mocap_vel)" name="pose_to_vel" pkg="position_to_velocity" type="position_to_velocity_node" output="screen" >
        <rosparam command="load" file="$(find position_to_velocity)/params/basic.yaml" />
    </node>

    <rosparam>
        use_sonar: true
        SD_Multiplied: 1
        Z_offset: 0.0
    </rosparam>

    <node name="verify_estimates" pkg="reef_estimator" type="verify_estimates.py" output="screen">
        <remap from="mocap/velocity/body_level_frame" to="velocity/body_level_frame"/>
        <remap from="xyz_debug_estimates" to="xyz_debug_estimate"/>
    </node>

    <node if="$(arg run_image_view)" name="image_view" pkg="image_view" type="image_view" output="screen">
        <remap from="image" to="camera/rgb/input_image" />
    </node>


</launch>